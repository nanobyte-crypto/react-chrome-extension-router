{"version":3,"file":"react-chrome-extension-router.cjs.production.min.js","sources":["../src/index.ts","../src/utils.ts"],"sourcesContent":["import * as React from 'react';\r\nimport { useForceUpdate } from './utils';\r\n\r\ntype RouterStackItem = {\r\n  component: React.ComponentType<any>;\r\n  props: any;\r\n};\r\n\r\nlet stack: RouterStackItem[] = [];\r\n\r\nlet forceUpdateStack: (() => void)[] = [];\r\n\r\nfunction useForceUpdateStack(): void {\r\n  const update = useForceUpdate();\r\n\r\n  React.useEffect(() => {\r\n    forceUpdateStack.push(update);\r\n\r\n    return () => {\r\n      const index = forceUpdateStack.indexOf(update);\r\n      if (index > -1) {\r\n        forceUpdateStack.splice(index, 1);\r\n      }\r\n    };\r\n  }, [update]);\r\n}\r\n\r\nfunction forceUpdate() {\r\n  forceUpdateStack.forEach(fn => fn());\r\n}\r\n\r\nfunction goTo(comp: React.ComponentType<any>, props: any = {}): void {\r\n  stack.push({ component: comp, props });\r\n  forceUpdate();\r\n}\r\n\r\nfunction goBack(): void {\r\n  if (stack.length) {\r\n    stack.pop();\r\n  }\r\n  forceUpdate();\r\n}\r\n\r\nfunction popToTop(): void {\r\n  stack = [];\r\n  forceUpdate();\r\n}\r\n\r\nfunction getCurrent(): RouterStackItem {\r\n  return stack[stack.length - 1] || { component: false, props: null };\r\n}\r\n\r\nfunction getComponentStack(): RouterStackItem[] {\r\n  return stack;\r\n}\r\n\r\ninterface LinkProps {\r\n  id?: string;\r\n  component: React.ComponentType<any>;\r\n  children?: React.ReactNode;\r\n  props?: any;\r\n  href?: string;\r\n  className?: string;\r\n  tag?: React.ComponentType<any> | keyof JSX.IntrinsicElements;\r\n  onClick?: (event: React.MouseEvent<HTMLAnchorElement>) => void;\r\n}\r\n\r\nfunction Link({\r\n  id = '',\r\n  component,\r\n  children,\r\n  props = {},\r\n  href = '',\r\n  className = '',\r\n  tag = 'a',\r\n  onClick,\r\n  ...restProps\r\n}: LinkProps & React.HTMLProps<HTMLElement>) {\r\n  const onClickHandler = React.useCallback(\r\n    (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n      evt.preventDefault();\r\n      if (component) {\r\n        goTo(component, props);\r\n      }\r\n      if (!component && href) {\r\n        window.open(href);\r\n      }\r\n      onClick && onClick(evt);\r\n    },\r\n    [component, props, href, onClick]\r\n  );\r\n\r\n  return React.createElement(\r\n    tag,\r\n    {\r\n      href,\r\n      className,\r\n      id,\r\n      onClick: onClickHandler,\r\n      ...restProps,\r\n    },\r\n    children\r\n  );\r\n}\r\n\r\ninterface NavLinkProps {\r\n  id?: string;\r\n  component: React.ComponentType<any>;\r\n  children?: React.ReactNode;\r\n  props?: any;\r\n  href?: string;\r\n  className?: string;\r\n  activeClassName?: string;\r\n  tag?: React.ComponentType<any> | keyof JSX.IntrinsicElements;\r\n  onClick?: (event: React.MouseEvent<HTMLAnchorElement>) => void;\r\n}\r\n\r\nfunction NavLink({\r\n  id = '',\r\n  component,\r\n  children,\r\n  props = {},\r\n  href = '',\r\n  className = '',\r\n  activeClassName = '',\r\n  tag = 'a',\r\n  onClick,\r\n  ...restProps\r\n}: NavLinkProps & React.HTMLProps<HTMLElement>) {\r\n  const onClickHandler = React.useCallback(\r\n    (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n      evt.preventDefault();\r\n      if (component) {\r\n        goTo(component, props);\r\n      }\r\n      if (!component && href) {\r\n        window.open(href);\r\n      }\r\n      onClick && onClick(evt);\r\n    },\r\n    [component, props, href, onClick]\r\n  );\r\n\r\n  useForceUpdateStack();\r\n\r\n  if (stack.length > 0 && stack[stack.length - 1].component === component) {\r\n    className = activeClassName + ' ' + className;\r\n  }\r\n\r\n  return React.createElement(\r\n    tag,\r\n    {\r\n      href,\r\n      className,\r\n      id,\r\n      onClick: onClickHandler,\r\n      ...restProps,\r\n    },\r\n    children\r\n  );\r\n}\r\n\r\ninterface RouterProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst emptyStackComponent: RouterStackItem = {\r\n  component: ({ children }: any) => children,\r\n  props: {},\r\n};\r\n\r\nfunction Router({ children }: RouterProps) {\r\n  useForceUpdateStack();\r\n\r\n  const { component: Component, props } =\r\n    stack[stack.length - 1] || emptyStackComponent;\r\n\r\n  return React.createElement(Component, props, children);\r\n}\r\n\r\nexport {\r\n  goBack,\r\n  getCurrent,\r\n  getComponentStack,\r\n  goTo,\r\n  popToTop,\r\n  LinkProps,\r\n  RouterProps,\r\n  Link,\r\n  NavLink,\r\n  Router,\r\n};\r\n","import { useCallback, useState } from 'react';\r\n\r\nfunction useForceUpdate(): () => void {\r\n  const [, dispatch] = useState(Object.create(null));\r\n\r\n  return useCallback(() => {\r\n    dispatch(Object.create(null));\r\n  }, [dispatch]);\r\n}\r\n\r\nexport { useForceUpdate };\r\n"],"names":["stack","forceUpdateStack","useForceUpdateStack","dispatch","update","useState","Object","create","useCallback","React","push","index","indexOf","splice","forceUpdate","forEach","fn","goTo","comp","props","component","emptyStackComponent","children","id","href","className","tag","onClick","restProps","onClickHandler","evt","preventDefault","window","open","activeClassName","length","pop"],"mappings":"8aAQA,IAAIA,EAA2B,GAE3BC,EAAmC,GAEvC,SAASC,QCTEC,EDUHC,GCVGD,EAAYE,WAASC,OAAOC,OAAO,UAErCC,eAAY,WACjBL,EAASG,OAAOC,OAAO,SACtB,CAACJ,KDQJM,aAAgB,kBACdR,EAAiBS,KAAKN,GAEf,eACCO,EAAQV,EAAiBW,QAAQR,GACnCO,GAAS,GACXV,EAAiBY,OAAOF,EAAO,MAGlC,CAACP,IAGN,SAASU,IACPb,EAAiBc,SAAQ,SAAAC,UAAMA,OAGjC,SAASC,EAAKC,EAAgCC,YAAAA,IAAAA,EAAa,IACzDnB,EAAMU,KAAK,CAAEU,UAAWF,EAAMC,MAAAA,IAC9BL,IAqIF,IAAMO,EAAuC,CAC3CD,UAAW,qBAAGE,UACdH,MAAO,iBArGT,oBACEI,GAAAA,aAAK,KACLH,IAAAA,UACAE,IAAAA,aACAH,MAAAA,aAAQ,SACRK,KAAAA,aAAO,SACPC,UAAAA,aAAY,SACZC,IAAAA,aAAM,MACNC,IAAAA,QACGC,gFAEGC,EAAiBpB,eACrB,SAACqB,GACCA,EAAIC,iBACAX,GACFH,EAAKG,EAAWD,IAEbC,GAAaI,GAChBQ,OAAOC,KAAKT,GAEdG,GAAWA,EAAQG,KAErB,CAACV,EAAWD,EAAOK,EAAMG,WAGpBlB,gBACLiB,KAEEF,KAAAA,EACAC,UAAAA,EACAF,GAAAA,EACAI,QAASE,GACND,GAELN,oBAgBJ,oBACEC,GAAAA,aAAK,KACLH,IAAAA,UACAE,IAAAA,aACAH,MAAAA,aAAQ,SACRK,KAAAA,aAAO,SACPC,UAAAA,aAAY,SACZS,gBAAAA,aAAkB,SAClBR,IAAAA,aAAM,MACNC,IAAAA,QACGC,kGAEGC,EAAiBpB,eACrB,SAACqB,GACCA,EAAIC,iBACAX,GACFH,EAAKG,EAAWD,IAEbC,GAAaI,GAChBQ,OAAOC,KAAKT,GAEdG,GAAWA,EAAQG,KAErB,CAACV,EAAWD,EAAOK,EAAMG,WAG3BzB,IAEIF,EAAMmC,OAAS,GAAKnC,EAAMA,EAAMmC,OAAS,GAAGf,YAAcA,IAC5DK,EAAYS,EAAkB,IAAMT,GAG/BhB,gBACLiB,KAEEF,KAAAA,EACAC,UAAAA,EACAF,GAAAA,EACAI,QAASE,GACND,GAELN,mBAaJ,gBAAkBA,IAAAA,SAChBpB,UAGEF,EAAMA,EAAMmC,OAAS,IAAMd,SAEtBZ,kBAHCW,YAAsBD,MAGeG,8BA7H/C,kBACStB,sBALT,kBACSA,EAAMA,EAAMmC,OAAS,IAAM,CAAEf,WAAW,EAAOD,MAAO,sBAb/D,WACMnB,EAAMmC,QACRnC,EAAMoC,MAERtB,qCAGF,WACEd,EAAQ,GACRc"}