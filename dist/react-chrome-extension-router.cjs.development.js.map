{"version":3,"file":"react-chrome-extension-router.cjs.development.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import { useCallback, useState } from 'react';\r\n\r\nfunction useForceUpdate(): () => void {\r\n  const [, dispatch] = useState(Object.create(null));\r\n\r\n  return useCallback(() => {\r\n    dispatch(Object.create(null));\r\n  }, [dispatch]);\r\n}\r\n\r\nexport { useForceUpdate };\r\n","import * as React from 'react';\r\nimport { useForceUpdate } from './utils';\r\n\r\ntype RouterStackItem = {\r\n  component: React.ComponentType<any>;\r\n  props: any;\r\n};\r\n\r\nlet stack: RouterStackItem[] = [];\r\n\r\nlet forceUpdateStack: (() => void)[] = [];\r\n\r\nfunction useForceUpdateStack(): void {\r\n  const update = useForceUpdate();\r\n\r\n  React.useEffect(() => {\r\n    forceUpdateStack.push(update);\r\n\r\n    return () => {\r\n      const index = forceUpdateStack.indexOf(update);\r\n      if (index > -1) {\r\n        forceUpdateStack.splice(index, 1);\r\n      }\r\n    };\r\n  }, [update]);\r\n}\r\n\r\nfunction forceUpdate() {\r\n  forceUpdateStack.forEach(fn => fn());\r\n}\r\n\r\nfunction goTo(comp: React.ComponentType<any>, props: any = {}): void {\r\n  stack.push({ component: comp, props });\r\n  forceUpdate();\r\n}\r\n\r\nfunction goBack(): void {\r\n  if (stack.length) {\r\n    stack.pop();\r\n  }\r\n  forceUpdate();\r\n}\r\n\r\nfunction popToTop(): void {\r\n  stack = [];\r\n  forceUpdate();\r\n}\r\n\r\nfunction getCurrent(): RouterStackItem {\r\n  return stack[stack.length - 1] || { component: false, props: null };\r\n}\r\n\r\nfunction getComponentStack(): RouterStackItem[] {\r\n  return stack;\r\n}\r\n\r\ninterface LinkProps {\r\n  id?: string;\r\n  component: React.ComponentType<any>;\r\n  children?: React.ReactNode;\r\n  props?: any;\r\n  href?: string;\r\n  className?: string;\r\n  tag?: React.ComponentType<any> | keyof JSX.IntrinsicElements;\r\n  onClick?: (event: React.MouseEvent<HTMLAnchorElement>) => void;\r\n}\r\n\r\nfunction Link({\r\n  id = '',\r\n  component,\r\n  children,\r\n  props = {},\r\n  href = '',\r\n  className = '',\r\n  tag = 'a',\r\n  onClick,\r\n  ...restProps\r\n}: LinkProps & React.HTMLProps<HTMLElement>) {\r\n  const onClickHandler = React.useCallback(\r\n    (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n      evt.preventDefault();\r\n      if (component) {\r\n        goTo(component, props);\r\n      }\r\n      if (!component && href) {\r\n        window.open(href);\r\n      }\r\n      onClick && onClick(evt);\r\n    },\r\n    [component, props, href, onClick]\r\n  );\r\n\r\n  return React.createElement(\r\n    tag,\r\n    {\r\n      href,\r\n      className,\r\n      id,\r\n      onClick: onClickHandler,\r\n      ...restProps,\r\n    },\r\n    children\r\n  );\r\n}\r\n\r\ninterface NavLinkProps {\r\n  id?: string;\r\n  component: React.ComponentType<any>;\r\n  children?: React.ReactNode;\r\n  props?: any;\r\n  href?: string;\r\n  className?: string;\r\n  activeClassName?: string;\r\n  tag?: React.ComponentType<any> | keyof JSX.IntrinsicElements;\r\n  onClick?: (event: React.MouseEvent<HTMLAnchorElement>) => void;\r\n}\r\n\r\nfunction NavLink({\r\n  id = '',\r\n  component,\r\n  children,\r\n  props = {},\r\n  href = '',\r\n  className = '',\r\n  activeClassName = '',\r\n  tag = 'a',\r\n  onClick,\r\n  ...restProps\r\n}: NavLinkProps & React.HTMLProps<HTMLElement>) {\r\n  const onClickHandler = React.useCallback(\r\n    (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n      evt.preventDefault();\r\n      if (component) {\r\n        goTo(component, props);\r\n      }\r\n      if (!component && href) {\r\n        window.open(href);\r\n      }\r\n      onClick && onClick(evt);\r\n    },\r\n    [component, props, href, onClick]\r\n  );\r\n\r\n  useForceUpdateStack();\r\n\r\n  if (stack.length > 0 && stack[stack.length - 1].component === component) {\r\n    className = activeClassName + ' ' + className;\r\n  }\r\n\r\n  return React.createElement(\r\n    tag,\r\n    {\r\n      href,\r\n      className,\r\n      id,\r\n      onClick: onClickHandler,\r\n      ...restProps,\r\n    },\r\n    children\r\n  );\r\n}\r\n\r\ninterface RouterProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst emptyStackComponent: RouterStackItem = {\r\n  component: ({ children }: any) => children,\r\n  props: {},\r\n};\r\n\r\nfunction Router({ children }: RouterProps) {\r\n  useForceUpdateStack();\r\n\r\n  const { component: Component, props } =\r\n    stack[stack.length - 1] || emptyStackComponent;\r\n\r\n  return React.createElement(Component, props, children);\r\n}\r\n\r\nexport {\r\n  goBack,\r\n  getCurrent,\r\n  getComponentStack,\r\n  goTo,\r\n  popToTop,\r\n  LinkProps,\r\n  RouterProps,\r\n  Link,\r\n  NavLink,\r\n  Router,\r\n};\r\n"],"names":["useForceUpdate","useState","Object","create","dispatch","useCallback","stack","forceUpdateStack","useForceUpdateStack","update","React","push","index","indexOf","splice","forceUpdate","forEach","fn","goTo","comp","props","component","goBack","length","pop","popToTop","getCurrent","getComponentStack","Link","id","children","href","className","tag","onClick","restProps","onClickHandler","evt","preventDefault","window","open","NavLink","activeClassName","emptyStackComponent","Router","Component"],"mappings":"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"}